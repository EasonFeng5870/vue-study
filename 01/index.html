<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="vue.js" ></script>
    <style>
    span:hover {
    background: lightgreen;
    }
    </style>
</head>
<body>
<div id="app">
    <button>{{orderinprogress}}</button>
    <div v-if="!orderinprogress" id="catalog">
        <p @click="displaylevel1=!displaylevel1" @mouseenter>{{ catalog.name }}</p>
        <div v-if="displaylevel1">
            <ul>
            <li v-for="c in categories" :key="c.id" @click.stop="displaylevel2=!displaylevel2">{{c.name}} | {{c.description}}
                <ul v-if="displaylevel2">
                    <li v-for="subc in c.subcategories" :key="subc.id" @click.stop="displayproducts=!displayproducts">{{subc.name}} | {{subc.description}}
                        <ul v-if="displayproducts">
                            <li v-for="p in subc.products" :key="p.id" @click.stop="product = p; quantity = ''; displaylevel1=false;" @mouseenter="">
                                <span>{{p.name}}</span>
                            </li>
                        </ul>
                    </li>
                </ul>
            </li>
        </ul>
        </div>
    </div>

    <div v-if="product !== '' && !orderinprogress" id="product">
        {{product.name}} {{product.price}} per {{product.unit}}
        <input type="number" min="0" max="10" v-model="quantity" />
        <button :disabled="quantity <= 0" @click="addToCart(product.id, quantity, product.unit, product.price)">Add {{quantity}} {{product.unit}} to cart</button>
    </div>

    <div v-if="cart.lineitems.length > 0" id="cart">
        <p>Shopping Cart</p>
        <ul>
            <li v-for="l in cart.lineitems" :key="l.id">
                Buy {{l.quantity}} {{l.unit}} of {{l.id}} priced at ${{l.price}} per {{l.unit}} in the amount of ${{l.amount}}
                <button @click="removeFromCart(l)">X</button>
            </li>
        </ul>
        Total: ${{cart.total}}
        <button @click="orderinprogress=!orderinprogress; startOrder()">Check Out</button>
    </div>

    <div v-if="tmporder.lineitems.length > 0" id="order">
        <p>Order Details</p>
        <div id="orderitems">
            <ul>
                <li v-for="l in tmporder.lineitems" :key="l.id">
                    Buy {{l.quantity}} {{l.unit}} of {{l.id}} priced at ${{l.price}} per {{l.unit}} in the amount of ${{l.amount}}
                    <button @click="orderinprogress=!orderinprogress; removeFromOrder(l)">X</button>
                </li>
            </ul>

        </div>
        <div id="address"></div>
        <div id="payinfo"></div>
        <button @click="orderinprogress=!orderinprogress; cancelOrder()">Cancel</button>
        <button>Place Order</button>

    </div>
</div>

<script src="./catalog.js"></script>
<script>
    let cart = { lineitems: [], total: 0 };
    let tmporder = { lineitems: [], address: {}, payment: {}, tax: 0, total: 0};
    let app = new Vue({
        el : '#app',
        data: {
            catalog: catalog,
            displaylevel1: false,
            displaylevel2: false,
            displayproducts: false,
            cart: cart,
            tmporder: tmporder,
            orderinprogress: false,
            categories: catalog.productcategories,
            quantity: '',
            product: ''
        },
        computed: {
          carttotal() {
            let t = 0;
            cart.lineitems.forEach(function (l) { t += l.price * l.quantity} );
            cart.total = t;
            return t;
          }
        },
        //components: {
        //    Product
        //},
        methods: {
            addToCart(pid, quant, unit, price, amount) {
                let lineitem = {id: pid, quantity: quant, unit: unit, price: price, amount: quant * price};
                cart.lineitems.push(lineitem);
                cart.total += quant * price;
            },
            removeFromCart(lineitem) {
              this.cart.lineitems.splice(this.cart.lineitems.indexOf(lineitem), 1);
              cart.total -= lineitem.quantity * lineitem.price;
            },
            startOrder() {
              tmporder.lineitems = [...cart.lineitems];
              cart.lineitems = [];
            },
            cancelOrder() {
              cart.lineitems = [...tmporder.lineitems];
              tmporder.lineitems = [];
            },
            removeFromOrder(lineitem) {
              this.tmporder.lineitems.splice(this.tmporder.lineitems.indexOf(lineitem), 1);
            }
        }
    });

</script>
</body>
</html>